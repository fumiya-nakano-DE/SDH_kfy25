<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <title>OSC Servo Sender WebUI</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
        const USE_FA = true;
        if (USE_FA) {
            var fa = document.createElement('script');
            fa.src = "https://kit.fontawesome.com/6be837db5c.js";
            fa.crossOrigin = "anonymous";
            document.head.appendChild(fa);
        } else {
            window.addEventListener('DOMContentLoaded', function () {
                document.querySelectorAll('i.fas, i.fa-solid').forEach(e => e.style.display = 'none');
            });
        }
    </script>
</head>

<body>
    <h2><i class="fas fa-microchip"></i> OSC Servo Sender WebUI</h2>
    <form id="mainForm" onsubmit="event.preventDefault(); customSubmit();">
        <label>
            <i class="fas fa-bullseye"></i>
            <span>Targets</span>
            <span style="display: flex; align-items: center; gap: 1em;">
                <label style="display: flex; align-items: center; margin: 0;">
                    <input type="checkbox" data-param="SEND_CLIENTS" {% if SEND_CLIENTS %}checked{% endif %}
                        onchange="updateParam(this)">
                    <span style="min-width:4em;">boards</span>
                </label>
            </span>
            <span style="display: flex; align-items: center; gap: 1em;">
                <label style="display: flex; align-items: center; margin: 0;">
                    <input type="checkbox" data-param="SEND_CLIENT_GH" {% if SEND_CLIENT_GH %}checked{% endif %}
                        onchange="updateParam(this)">
                    <span style="min-width:4em;">gh</span>
                </label>
            </span>
        </label>
        <label>
            <i class="fas fa-cogs"></i>
            <span>NUM_SERVOS</span>
            <input name="NUM_SERVOS" value="{{NUM_SERVOS}}" {% if running %}readonly{% endif %}>
        </label>
        <label>
            <i class="fas fa-tachometer-alt"></i>
            <span>RATE_fps</span>
            <input name="RATE_fps" value="{{RATE_fps}}" {% if running %}readonly{% endif %}>
        </label>
        <hr>
        <label>
            <i class="fas fa-arrows-alt-h"></i>
            <span>STROKE_OFFSET</span>
            <input type="range" min="-100000" max="100000" step="100" value="{{ STROKE_OFFSET }}"
                data-param="STROKE_OFFSET" data-endpoint="/set_stroke_offset" data-output="stroke_offset_out"
                oninput="updateParam(this)">
            <output id="stroke_offset_out">{{ STROKE_OFFSET }}</output>
        </label>
        <label>
            <i class="fas fa-filter"></i>
            <span>LPF ALPHA</span>
            <input type="range" min="0" max="1" step="0.01" value="{{ ALPHA }}" name="ALPHA" data-param="ALPHA"
                data-endpoint="/set_alpha" data-output="alpha_out" oninput="updateParam(this)">
            <output id="alpha_out">{{ ALPHA }}</output>
        </label>
        <hr>
        <label>
            <i class="fas fa-sliders-h"></i>
            <span>Kp</span>
            <input type="range" min="0" max="0.5" step="0.01" value="{{ Kp }}" data-param="Kp" data-output="kp_out"
                oninput="updateParam(this)">
            <output id="kp_out">{{ Kp }}</output>
        </label>
        <label>
            <i class="fas fa-sliders-h"></i>
            <span>Ki</span>
            <input type="range" min="0" max="0.5" step="0.01" value="{{ Ki }}" data-param="Ki" data-output="ki_out"
                oninput="updateParam(this)">
            <output id="ki_out">{{ Ki }}</output>
        </label>
        <label>
            <i class="fas fa-sliders-h"></i>
            <span>Kd</span>
            <input type="range" min="0" max="0.5" step="0.01" value="{{ Kd }}" data-param="Kd" data-output="kd_out"
                oninput="updateParam(this)">
            <output id="kd_out">{{ Kd }}</output>
        </label>

        <button type="button" onclick="sendStep()" {% if running %}disabled{% endif %}>
            <i class="fas fa-step-backward"></i><i class="fas fa-step-forward"></i> Step
        </button>
        <hr style="border-top: 3px double">
        <label>
            <i class="fas fa-toggle-on"></i>
            <span>MODE</span>
            <select id="mode-select" data-param="MODE" onchange="changeMode(this)">
                {% for mode_id, mode in MODES.items() %}
                <option value="{{ mode_id }}" {% if MODE==mode_id %}selected{% endif %}>
                    {{ mode_id }}: {{ mode.NAME }}
                </option>
                {% endfor %}
            </select>
        </label>
        <label>
            <i class="fas fa-wave-square"></i>
            <span>BASE_FREQ[Hz]</span>
            <input type="range" min="0" max="2.0" step="0.01" value="{{ BASE_FREQ }}" data-param="BASE_FREQ"
                data-output="base_freq_out" oninput="updateParam(this)">
            <output id="base_freq_out">{{ BASE_FREQ }}</output>
        </label>
        <label>
            <i class="fas fa-arrows-alt-v"></i>
            <span>DIRECTION</span>
            <input type="range" min="-1" max="1" step="2" value="{{ DIRECTION }}" data-param="DIRECTION"
                data-output="dir_out" oninput="updateParam(this)">
            <output id="dir_out">{{ DIRECTION }}</output>
        </label>
        <label>
            <i class="fas fa-sync-alt"></i>
            <span>PHASE_RATE</span>
            <input type="range" min="0" max="8" step="0.1" value="{{ PHASE_RATE }}" data-param="PHASE_RATE"
                data-endpoint="/set_phase_rate" data-output="phase_rate_out" oninput="updateParam(this)">
            <output id="phase_rate_out">{{ PHASE_RATE }}</output>
        </label>
        <label>
            <i class="fas fa-a"></i>
            <span>PARAM_A</span>
            <input type="range" min="0" max="1" step="0.01" value="{{ PARAM_A }}" data-param="PARAM_A"
                data-endpoint="/set_param_a" data-output="param_a_out" oninput="updateParam(this)">
            <output id="param_a_out">{{ PARAM_A }}</output>
        </label>
        <label>
            <i class="fas fa-b"></i>
            <span>PARAM_B</span>
            <input type="range" min="0" max="1" step="0.01" value="{{ PARAM_B }}" data-param="PARAM_B"
                data-endpoint="/set_param_b" data-output="param_b_out" oninput="updateParam(this)">
            <output id="param_b_out">{{ PARAM_B }}</output>
        </label>
        <label>
            <i class="fa-solid fa-ruler-horizontal"></i>
            <span>STROKE_LENGTH</span>
            <input type="range" min="1000" max="100000" step="1000" value="{{ STROKE_LENGTH }}"
                data-param="STROKE_LENGTH" data-endpoint="/set_stroke_length" data-output="stroke_length_out"
                oninput="updateParam(this)">
            <output id="stroke_length_out">{{ STROKE_LENGTH }}</output>
        </label>
        <label>
            <i class="fas fa-water"></i>
            <span>AMP_FREQ[Hz]</span>
            <input type="range" min="-2" max="2.0" step="0.01" value="{{ AMP_FREQ }}" data-param="AMP_FREQ"
                data-output="amp_freq_out" oninput="updateParam(this)">
            <output id="amp_freq_out">{{ AMP_FREQ }}</output>
        </label>
        <label>
            <i class="fas fa-a"></i>
            <span>AMP_PARAM_A</span>
            <input type="range" min="0" max="1" step="0.01" value="{{ AMP_PARAM_A }}" data-param="AMP_PARAM_A"
                data-endpoint="/set_amp_param_a" data-output="amp_param_a_out" oninput="updateParam(this)">
            <output id="amp_param_a_out">{{ AMP_PARAM_A }}</output>
        </label>
        <label>
            <i class="fas fa-b"></i>
            <span>AMP_PARAM_B</span>
            <input type="range" min="0" max="1" step="0.01" value="{{ AMP_PARAM_B }}" data-param="AMP_PARAM_B"
                data-endpoint="/set_amp_param_b" data-output="amp_param_b_out" oninput="updateParam(this)">
            <output id="amp_param_b_out">{{ AMP_PARAM_B }}</output>
        </label>

        <button type="button" onclick="customSubmit()">
            {% if running %}
            <i class="fas fa-pause"></i>Stop
            {% else %}
            <i class="fas fa-play"></i>Start
            {% endif %}
        </button>
        {% if running %}
        <i class="fas fa-spinner fa-spin"></i>sending OSC...
        {% else %}
        <hr style="border-top: 3px double">
        <button type="button" onclick="sendSetNeutral()">
            <i class="fas fa-undo"></i> Neutral
        </button>
        <button type="button" onclick="sendHomeAll()">
            <i class="fas fa-home"></i> Home All
        </button>
        <button type="button" id="init-button" onclick="sendInit()">
            <i class="fas fa-power-off"></i> Init
        </button>
        <button type="button" onclick="sendRelease()" {% if running %}disabled{% endif %}>
            <i class="fas fa-unlock"></i> Release
        </button>

        {% endif %}
        <span id="form-loading" style="display:none; color:#2a7;">
            <i class="fa-solid fa-spinner fa-spin"></i> configuring...
        </span>
    </form>
    <br>
    <form id="independentControllerForm">
        <div style="margin-bottom:1em;">
            <label>
                <i class="fas fa-dot-circle"></i>
                <span>motorID</span>
                <input type="number" id="motor-id-input" min="1" max="{{NUM_SERVOS|int}}" value="1" style="width:4em;">
            </label>
            <label>
                <i class="fas fa-crosshairs"></i>
                <span>Target Position</span>
                <input type="number" id="target-position-input" value="0" step="1000" style="width:8em;">
            </label>
            <button type="button" onclick="sendResetPos()">
                <i class="fas fa-undo"></i> Set as Zero.
            </button>
            <button type="button" onclick="sendHoming()">
                <i class="fas fa-home"></i> Homing
            </button>
            <button type="button" onclick="getTargetPosition()">
                <i class="fas fa-search-location"></i> Get
            </button>
            <button type="button" onclick="sendSetTargetPosition()">
                <i class="fas fa-bullseye"></i> Set
            </button>
        </div>
    </form>
    <script src="/static/main.js"></script>
</body>

</html>